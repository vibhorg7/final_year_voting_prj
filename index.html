<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>EVote</title>

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">

    <script src="./node_modules/web3/dist/web3.min.js"></script>
<script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>
<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>

<style>
/* The flip card container - set the width and height to whatever you want. We have added the border property to demonstrate that the flip itself goes out of the box on hover (remove perspective if you don't want the 3D effect */
.flip-card {
  background-color: transparent;
  width: 300px;
  height: 200px;
  border: 1px solid #f1f1f1;
  perspective: 1000px; /* Remove this if you don't want the 3D effect */
}

/* This container is needed to position the front and back side */
.flip-card-inner {
  position: relative;
  width: 100%;
  height: 100%;
  text-align: center;
  transition: transform 0.8s;
  transform-style: preserve-3d;
}

/* Do an horizontal flip when you move the mouse over the flip box container */
.flip-card:hover .flip-card-inner {
  transform: rotateY(180deg);
}

/* Position the front and back side */
.flip-card-front, .flip-card-back {
  position: absolute;
  width: 100%;
  height: 100%;
  -webkit-backface-visibility: hidden; /* Safari */
  backface-visibility: hidden;
}

/* Style the front side (fallback if image is missing) */
.flip-card-front {
  background-color: #bbb;
  color: black;
}

/* Style the back side */
.flip-card-back {
  background-color: dodgerblue;
  color: white;
  transform: rotateY(180deg);
}

.jumbotron{width:1600px;}
</style>


</head>
<body>
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
  <a class="navbar-brand" href="#">EVote</a>
  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  <div class="collapse navbar-collapse" id="navbarSupportedContent">
    <ul class="navbar-nav mr-auto">
      <li class="nav-item active">
        <a class="nav-link" href="#">Home <span class="sr-only">(current)</span></a>
      </li>
      
    </ul>
    <form class="form-inline my-2 my-lg-0">
      <div class="nav-item dropdown my-2 my-lg-2">
        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
          Previous Elections
        </a>
        <div class="dropdown-menu" aria-labelledby="navbarDropdown">
          <a class="dropdown-item" href="#">Worker Union Head Elections</a>
          <div class="dropdown-divider"></div>
          <a class="dropdown-item" href="#">About us</a>
        </div>
      </div>
      <button class="btn btn-outline-success my-2 my-sm-0" type="submit">Logout</button>
    </form>
  </div>
</nav>
<br><br>
<center>
<div class="jumbotron">

<br>
        <h1><center>Elections</center></h1>
<br>

<br>


<br>
<div class="container">
  <div class="row">
    <div class="col-sm">
      <div class="flip-card">
  <div class="flip-card-inner">
    <div class="flip-card-front">
      <img src="modi.jpeg" alt="Modiji" style="width:300px;height:300px;">
    </div>
    <div class="flip-card-back">
      <p>Bhartiya Janta Party</p>
      <p>Modi Rocks</p>
    </div>
  </div>

</div>
<br><br><br><br><br><br>
<center><h2>Narendra Modi</h2></center>
<br>
<center><label><input type ="radio" name="candidates" value=1>Vote</label><center>
    </div>
    <div class="col-sm">
      <div class="flip-card">
  <div class="flip-card-inner">
    <div class="flip-card-front">
      <img src="rg.jpeg" alt="Modiji" style="width:300px;height:300px;">
    </div>
    <div class="flip-card-back">
      <p>Congress Party</p>
      <p>Senior Candidate</p>
    </div>
  </div>
</div>
<br><br><br><br><br><br>
<center><h2>Rahul Gandhi</h2></center>
<br>
<center><label><input type ="radio" name="candidates" value=2>Vote</label></center>
    </div>
    <div class="col-sm">
      <div class="flip-card">
  <div class="flip-card-inner">
    <div class="flip-card-front">
      <img src="ak.jpg" alt="Modiji" style="width:300px;height:300px;">
    </div>
    <div class="flip-card-back">
      <p>Aam Aadmi Party</p>
      <p>the common man</p>
    </div>
  </div>
</div>
<br><br><br><br><br><br>
<center><h2>Arvind Kejriwal</h2></center>
<br>
<center><label><input type ="radio" name="candidates" value=3>Vote</label></center>
    </div>
  </div>
</div>




<br><br><br><br><br>


<center><button type="button" class="btn btn-success btn-lg" id="vote">Vote</button></center>

<br><br><br>
<center>
<div id="piechart" style="display:none">
</div>
</center>
</div>
<center>

    <script>
   	

	        if (typeof web3 !== 'undefined') {
            web3 = new Web3(web3.currentProvider);
        } else {
            // set the provider you want from Web3.providers
            web3 = new Web3(new Web3.providers.HttpProvider("http://localhost:8545"));
        }
	
	        web3.eth.defaultAccount = web3.eth.accounts[3];
var election = web3.eth.contract([
	{
		"constant": false,
		"inputs": [
			{
				"name": "_candidateId",
				"type": "uint256"
			}
		],
		"name": "vote",
		"outputs": [],
		"payable": false,
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [],
		"payable": false,
		"stateMutability": "nonpayable",
		"type": "constructor"
	},
	{
		"constant": true,
		"inputs": [
			{
				"name": "",
				"type": "uint256"
			}
		],
		"name": "candidates",
		"outputs": [
			{
				"name": "id",
				"type": "uint256"
			},
			{
				"name": "name",
				"type": "string"
			},
			{
				"name": "voteCount",
				"type": "uint256"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [],
		"name": "candidatesCount",
		"outputs": [
			{
				"name": "",
				"type": "uint256"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [
			{
				"name": "",
				"type": "address"
			}
		],
		"name": "voters",
		"outputs": [
			{
				"name": "",
				"type": "bool"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	}
]);


        var ele = election.at('0x1da48823dd717530ddb8ff1f45ecba8054fe935a');
        console.log(ele);





	        $("#vote").click(function() {
            var radioValue = $("input[name='candidates']:checked").val();
            if(radioValue){
                alert("Your voted for " + radioValue);
ele.vote(radioValue)



            }
var x= document.getElementById("vote");
x.style.display="none";
var y = document.getElementById("piechart");
y.style.display="block";
        });

setInterval("my_func()",3000);
//res=ele.candidates(1);
//var a=res[1];
//var b= parseInt(res[2]);
//console.log(parseInt(res[2]));

google.charts.load('current', {'packages':['corechart']});
google.charts.setOnLoadCallback(drawChart);

function my_func(){

var arr= new Array(100);
var j=0;

for (var i = 0; i < ele.candidatesCount(); i++) {
  	res=ele.candidates(i+1)
//console.log(res[1],parseInt(res[2]));
arr[j] = res[1];
arr[j+1]=parseInt(res[2]);
j=j+2;

}

drawChart(...arr);


  //$('#vtable').append('<tr><td>' + res[0] + '</td><td>' + res[1] + '</td><td>' +
  //res[2]+ '</td></tr>');

}




function drawChart(a,b,c,d,e,f) {
//console.log(a,b,c,d,e,f);
  var data = google.visualization.arrayToDataTable([
  ['Candidate', 'Votes'],
  [a, b],
  [c, d],
[e,f]


]);

  // Optional; add a title and set the width and height of the chart
  var options = {title:'Votes', 'width':'550', 'height':'400',is3D:true};

  // Display the chart inside the <div> element with id="piechart"
 var chart = new google.visualization.PieChart(document.getElementById('piechart'));
  chart.draw(data, options);
}








    </script>

</body>
</html>
